# æ¨¡å—åŒ– Telegram Bot

ä¸€ä¸ªé«˜åº¦å¯æ‰©å±•ã€æ¨¡å—åŒ–çš„ Telegram Bot æ¡†æ¶ï¼Œæ”¯æŒäº‹ä»¶ç³»ç»Ÿå’ŒçŠ¶æ€ç®¡ç†ã€‚

## ç‰¹æ€§

- ğŸ§© **æ¨¡å—åŒ–æ¶æ„**ï¼šæ¸…æ™°çš„æ¨¡å—ç»„ç»‡ï¼Œæ”¯æŒç§èŠå’Œç¾¤ç»„æ¨¡å—åŒºåˆ†
- ğŸ”„ **é…ç½®ç®¡ç†**ï¼šçµæ´»çš„é…ç½®ç³»ç»Ÿ
- ğŸ›¡ï¸ **å¤šçº§æƒé™ç®¡ç†**ï¼šæ”¯æŒè¶…çº§ç®¡ç†å‘˜ã€ç¾¤ç»„ç®¡ç†å‘˜å’Œæ™®é€šç”¨æˆ·
- ğŸ”’ **ç¾¤ç»„ç™½åå•**ï¼šåªå…è®¸æˆæƒçš„ç¾¤ç»„ä½¿ç”¨æœºå™¨äºº
- ğŸ“Š **çŠ¶æ€ç®¡ç†**ï¼šæ¨¡å—çŠ¶æ€æŒä¹…åŒ–å’Œè‡ªåŠ¨å¤‡ä»½
- ğŸ“¡ **äº‹ä»¶ç³»ç»Ÿ**ï¼šæ¨¡å—é—´æ¾è€¦åˆé€šä¿¡å’Œäº‹ä»¶æµæ§åˆ¶
- ğŸ”¤ **æ–‡æœ¬æ ¼å¼åŒ–**ï¼šæ™ºèƒ½å¤„ç† Markdown å’Œ HTMLï¼Œè‡ªåŠ¨é™çº§
- ğŸ“‹ **å®Œå–„çš„æ—¥å¿—ç³»ç»Ÿ**ï¼šæ”¯æŒæ—¥å¿—è½®è½¬å’Œè‡ªåŠ¨æ¸…ç†
- ğŸ“± **ä¼šè¯ç®¡ç†**ï¼šæŒä¹…åŒ–çš„ç”¨æˆ·ä¼šè¯æ”¯æŒ
- ğŸ“„ **åˆ†é¡µæ˜¾ç¤º**ï¼šè‡ªåŠ¨å¤„ç†é•¿åˆ—è¡¨çš„åˆ†é¡µå¯¼èˆª
- ğŸ³ **Docker æ”¯æŒ**ï¼šè½»æ¾éƒ¨ç½²å’Œç»´æŠ¤

## AI ç”Ÿæˆé¡¹ç›®å£°æ˜

> æœ¬é¡¹ç›®ç”± AI ç”Ÿæˆã€‚ä½œä¸ºç»´æŠ¤è€…ï¼Œæˆ‘ç¼ºä¹ä¸“ä¸šçŸ¥è¯†æ¥å¤„ç†ç›¸å…³æŠ€æœ¯é—®é¢˜ã€‚
>
> â­ å› æ­¤ï¼Œæˆ‘æ— æ³•æ¥å—ä»»ä½•é’ˆå¯¹æœ¬é¡¹ç›®çš„ Issue æˆ– Pull requestã€‚
>
> æ¬¢è¿æŒ‰ç…§ MIT è®¸å¯è¯è‡ªç”±å¤åˆ¶å’Œä¿®æ”¹æ­¤é¡¹ç›®ä»¥ä¾›æ‚¨è‡ªå·±ä½¿ç”¨ã€‚

## å¿«é€Ÿå¼€å§‹

### é…ç½®

åœ¨éƒ¨ç½²å‰ï¼Œæ‚¨å¿…é¡»å‡†å¤‡é…ç½®æ–‡ä»¶æˆ–ç¯å¢ƒå˜é‡ã€‚

1. å¤åˆ¶ç¤ºä¾‹é…ç½®æ–‡ä»¶ï¼š

   ```bash
   cp config/config.json.example config/config.json
   ```

2. ç¼–è¾‘é…ç½®æ–‡ä»¶ï¼Œæ·»åŠ ä½ çš„ Telegram Bot Token å’Œè¶…çº§ç®¡ç†å‘˜ IDï¼š

   ```json
   {
     "token": "YOUR_TELEGRAM_BOT_TOKEN_HERE",
     "admin_ids": [123456789],
     "log_level": "INFO",
     "allowed_groups": {},
     "network": {
       "connect_timeout": 20.0,
       "read_timeout": 20.0,
       "write_timeout": 20.0,
       "poll_interval": 1.0
     }
   }
   ```

3. å¦‚æœä½¿ç”¨ç¯å¢ƒå˜é‡é…ç½®ï¼Œéœ€è¦è®¾ç½®ä»¥ä¸‹å˜é‡ï¼š

- `TELEGRAM_BOT_TOKEN`ï¼šæ‚¨çš„ Telegram Bot Token
- `ADMIN_IDS`ï¼šè¶…çº§ç®¡ç†å‘˜ IDï¼Œå¤šä¸ª ID ç”¨é€—å·åˆ†éš”

ä½¿ç”¨ Docker éƒ¨ç½²æ—¶ï¼Œé…ç½®çš„ä¼˜å…ˆçº§ä¸ºï¼šç¯å¢ƒå˜é‡ > é…ç½®æ–‡ä»¶

é¦–æ¬¡è¿è¡Œæ—¶ï¼Œå¦‚æœæ²¡æœ‰æä¾›æœ‰æ•ˆçš„ Token å’Œ IDï¼Œæœºå™¨äººå°†æ— æ³•å¯åŠ¨

### éƒ¨ç½²æ–¹å¼

**æ–¹å¼ 1: ä½¿ç”¨ Python è™šæ‹Ÿç¯å¢ƒ**

```bash
# åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ
python -m venv venv

# æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ
# Windows
venv\Scripts\activate
# Linux/macOS
source venv/bin/activate

# å®‰è£…ä¾èµ–
pip install -r requirements.txt

# è¿è¡Œ Bot
python bot.py
```

**æ–¹å¼ 2: Docker Compose ï¼ˆæ¨èï¼‰**

```bash
# å¯åŠ¨å®¹å™¨
# ç¡®ä¿ config/config.json å·²æ­£ç¡®é…ç½®
# æˆ–ä½¿ç”¨ç¯å¢ƒå˜é‡
# åˆ›å»º .env æ–‡ä»¶
echo "TELEGRAM_BOT_TOKEN=your_token_here" > .env
echo "ADMIN_IDS=123456789" >> .env

# å¯åŠ¨å®¹å™¨
docker-compose up -d

# æŸ¥çœ‹æ—¥å¿—
docker-compose logs -f
```

**æ–¹å¼ 3: Docker**

```bash
# æ„å»ºé•œåƒ
docker build -t modular-telegram-bot .

# è¿è¡Œå®¹å™¨ï¼ˆä½¿ç”¨å·²é…ç½®çš„ configï¼‰
docker run -d --name telegram-bot -v ./config:/app/config modular-telegram-bot

# æˆ–è€…ä½¿ç”¨ç¯å¢ƒå˜é‡è¿è¡Œ
docker run -d --name telegram-bot -e TELEGRAM_BOT_TOKEN=your_token_here -e ADMIN_IDS=123456789 -v ./config:/app/config modular-telegram-bot
```

**æ–¹å¼ 4: Systemd æœåŠ¡**

åˆ›å»ºæœåŠ¡æ–‡ä»¶ `/etc/systemd/system/telegram-bot.service`ï¼š

```ini
[Unit]
Description=Modular Telegram Bot
After=network.target

[Service]
Type=simple
User=botuser
WorkingDirectory=/path/to/bot
ExecStart=/path/to/venv/bin/python /path/to/bot/bot.py
Restart=on-failure
RestartSec=10

[Install]
WantedBy=multi-user.target
```

å¯åŠ¨æœåŠ¡ï¼š

```bash
sudo systemctl enable telegram-bot
sudo systemctl start telegram-bot
sudo systemctl status telegram-bot
```

### ä½¿ç”¨æ–¹æ³•

**åŸºæœ¬å‘½ä»¤**

- `/start` - å¯åŠ¨æœºå™¨äºº
- `/help` - æ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯
- `/id` - æ˜¾ç¤ºç”¨æˆ·å’ŒèŠå¤© ID
- `/modules` - åˆ—å‡ºæ‰€æœ‰å·²åŠ è½½æ¨¡å—
- `/commands` - åˆ—å‡ºæ‰€æœ‰å¯ç”¨å‘½ä»¤

**ç®¡ç†å‘˜å‘½ä»¤**

- `/stats` - æ˜¾ç¤ºæœºå™¨äººç»Ÿè®¡ä¿¡æ¯ï¼ˆè¶…çº§ç®¡ç†å‘˜ï¼‰
- `/listgroups` - åˆ—å‡ºæˆæƒçš„ç¾¤ç»„ï¼ˆè¶…çº§ç®¡ç†å‘˜ï¼‰
- `/addgroup [ç¾¤ç»„ ID]` - æ·»åŠ ç¾¤ç»„åˆ°ç™½åå•ï¼ˆè¶…çº§ç®¡ç†å‘˜ï¼‰
- `/removegroup <ç¾¤ç»„ ID>` - ä»ç™½åå•ç§»é™¤ç¾¤ç»„ï¼ˆè¶…çº§ç®¡ç†å‘˜ï¼‰

### å¼€å‘æ¨¡å—

æˆ‘ä»¬æä¾›äº†è¯¦ç»†çš„æ¨¡å—å¼€å‘æ–‡æ¡£ï¼Œè¯·å‚é˜… `modules/README.md` äº†è§£å¦‚ä½•å¼€å‘æ–°æ¨¡å—ã€‚è¯¥æ–‡æ¡£æ¶µç›–ï¼š

- æ¨¡å—åŸºæœ¬ç»“æ„å’Œå…ƒæ•°æ®
- ModuleInterface æ¥å£ä½¿ç”¨
- å‘½ä»¤æ³¨å†Œå’Œæƒé™ç®¡ç†
- äº‹ä»¶ç³»ç»Ÿä½¿ç”¨æ–¹æ³•
- çŠ¶æ€ç®¡ç†å’ŒæŒä¹…åŒ–
- æ–‡æœ¬å¤„ç†å’Œæ ¼å¼åŒ–
- åˆ†é¡µåˆ—è¡¨å®ç°
- æœ€ä½³å®è·µå’Œç¤ºä¾‹æ¨¡å—

### é¡¹ç›®ç»“æ„

```
.
â”œâ”€â”€ bot.py                    # ä¸»å…¥å£ç‚¹
â”œâ”€â”€ config/                   # é…ç½®ç›®å½•
â”‚   â””â”€â”€ config.json           # ä¸»é…ç½®
â”œâ”€â”€ core/                     # æ ¸å¿ƒç»„ä»¶
â”‚   â”œâ”€â”€ bot_engine.py         # æ ¸å¿ƒå¼•æ“
â”‚   â”œâ”€â”€ module_manager.py     # æ¨¡å—ç®¡ç†å™¨
â”‚   â”œâ”€â”€ command_manager.py    # å‘½ä»¤ç®¡ç†å™¨
â”‚   â”œâ”€â”€ config_manager.py     # é…ç½®ç®¡ç†å™¨
â”‚   â””â”€â”€ event_system.py       # äº‹ä»¶ç³»ç»Ÿ
â”œâ”€â”€ modules/                  # æ¨¡å—ç›®å½•
â”‚   â”œâ”€â”€ README.md             # æ¨¡å—å¼€å‘æ–‡æ¡£
â”‚   â””â”€â”€ echo.py               # ç¤ºä¾‹æ¨¡å—
â”œâ”€â”€ utils/                    # å·¥å…·å‡½æ•°
â”‚   â”œâ”€â”€ formatter.py          # æ–‡æœ¬æ ¼å¼å·¥å…·
â”‚   â”œâ”€â”€ logger.py             # æ—¥å¿—å·¥å…·
â”‚   â”œâ”€â”€ pagination.py         # åˆ†é¡µå·¥å…·
â”‚   â”œâ”€â”€ session_manager.py    # ä¼šè¯ç®¡ç†å™¨
â”‚   â””â”€â”€ state_manager.py      # çŠ¶æ€ç®¡ç†å™¨
â””â”€â”€ data/                     # æ•°æ®ç›®å½•
    â”œâ”€â”€ sessions/             # ä¼šè¯æ•°æ®å­˜å‚¨
    â””â”€â”€ states/               # æ¨¡å—çŠ¶æ€å­˜å‚¨
```

## ç¨³å®šæ€§å’Œå¯é æ€§

æœ¬æ¡†æ¶ç»è¿‡ç²¾å¿ƒè®¾è®¡ï¼Œä»¥æä¾›é«˜åº¦çš„ç¨³å®šæ€§å’Œå¯é æ€§ï¼š

- ç®€åŒ–çš„æ¶æ„è®¾è®¡ï¼Œæ˜“äºç†è§£å’Œç»´æŠ¤
- ä¼˜é›…çš„é”™è¯¯å¤„ç†å’Œå¼‚å¸¸æ¢å¤
- æ¨¡å—éš”ç¦»ï¼Œé˜²æ­¢å•ä¸ªæ¨¡å—å´©æºƒå½±å“ç³»ç»Ÿ
- å®šæœŸèµ„æºæ¸…ç†ï¼Œé˜²æ­¢å†…å­˜æ³„æ¼
- è‡ªåŠ¨çŠ¶æ€å¤‡ä»½å’Œæ¢å¤
- èŠå¤©ç±»å‹è¿‡æ»¤æœºåˆ¶ï¼Œç¡®ä¿æ¨¡å—åœ¨é€‚å½“çš„èŠå¤©ç¯å¢ƒä¸­è¿è¡Œ

## è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ MIT è®¸å¯è¯ï¼Œè¯¦è§ LICENSE æ–‡ä»¶ã€‚
